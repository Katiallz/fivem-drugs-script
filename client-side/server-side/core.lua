-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
local Proxy = module("vrp","lib/Proxy")
vRPC = Tunnel.getInterface("vRP")
vRP = Proxy.getInterface("vRP")

-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
Street = {}
Tunnel.bindInterface("inventory",Street)

-----------------------------------------------------------------------------------------------------------------------------------------
-- VARIABLES
-----------------------------------------------------------------------------------------------------------------------------------------
local Drugs = {}

-----------------------------------------------------------------------------------------------------------------------------------------
-- DRUGSLIST
-----------------------------------------------------------------------------------------------------------------------------------------
local DrugsList = {
	["cocaine"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 1, ["Max"] = 3 }
	},
	["joint"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 1, ["Max"] = 3 }
	},
	["meth"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 1, ["Max"] = 3 }
	},
	["lean"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 1, ["Max"] = 3 }
	},
	["lanca"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 1, ["Max"] = 3 }
	},
	["oxy"] = {
		Price = { ["Min"] = 1000, ["Max"] = 1000 },
		Amount = { ["Min"] = 2, ["Max"] = 3 }
	}
}

-----------------------------------------------------------------------------------------------------------------------------------------
-- CHECKDRUGS
-----------------------------------------------------------------------------------------------------------------------------------------
function Street.CheckDrugs()
	local source = source
	local Passport = vRP.Passport(source)
	if Passport then
		for k,v in pairs(DrugsList) do
			local Amount = math.random(v["Amount"]["Min"],v["Amount"]["Max"])
			local Price = math.random(v["Price"]["Min"],v["Price"]["Max"])

			local Consult = vRP.InventoryItemAmount(Passport,k)
			if Consult[1] >= Amount then
				Drugs[Passport] = { Consult[2], Amount, Price * Amount }
				return true
			end
		end
	end
	return false
end

-----------------------------------------------------------------------------------------------------------------------------------------
-- PAYMENTDRUGS
-----------------------------------------------------------------------------------------------------------------------------------------
function Street.PaymentDrugs()
	local source = source
	local Passport = vRP.Passport(source)

	if Passport and Drugs[Passport] then
		if vRP.TakeItem(Passport,Drugs[Passport][1],Drugs[Passport][2],true) then
			vRP._GenerateItem(Passport,"dollars2",Drugs[Passport][3],true)
			TriggerEvent("Wanted",source,Passport,60)
			Drugs[Passport] = nil
		end
	end
end

-----------------------------------------------------------------------------------------------------------------------------------------
-- DISCONNECT
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("Disconnect",function(Passport)
	if Drugs[Passport] then
		Drugs[Passport] = nil
	end
end)

-----------------------------------------------------------------------------------------------------------------------------------------
-- START MESSAGE (FXSERVER ONLY)
-----------------------------------------------------------------------------------------------------------------------------------------
print("^2====================================================^7")
print("^2 Sistema de Venda carregado com sucesso! ^7")
print("^5 Criador By Katiaallz^7")
print("^2====================================================^7")
